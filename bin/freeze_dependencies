#!/usr/bin/env bash
set -e

vrdscommon_dep=$(cat requirements-dev.yaml | grep vrdscommon)
project_package_name=$(python -c "from pkg_resources import safe_name; print(safe_name('pytorch_common'))")
sed_project_name_pattern='/.*'$project_package_name'==.*/d'
# remove last two lines since those are not dependencies
# also remove vrdscommon dependency so we then replace it by the git url and remove the current project
conda env export -n pytorch_common | sed '$d' | sed '$d' | sed '/.*vrdscommon.*/d' | sed $sed_project_name_pattern > requirements.yaml
echo "$vrdscommon_dep" >> requirements.yaml
echo "Version dependencies have been output to requirements.yaml"
